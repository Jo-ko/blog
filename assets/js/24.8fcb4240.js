(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{569:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"现代浏览器基本结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#现代浏览器基本结构"}},[t._v("#")]),t._v(" 现代浏览器基本结构")]),t._v(" "),a("p",[t._v("关于如何构建 Web 浏览器并没有标准规范，不同浏览器的架构可能完全不同, PC版的和移动版的也是有区别的")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tips")]),t._v(" "),a("ol",[a("li",[t._v("User Interface\n"),a("ul",[a("li",[t._v("用户界面,提供用户与Browser Engine的交互界面接口,包括搜索栏,前进/后退按钮等")])])]),t._v(" "),a("li",[t._v("Browser Engine\n"),a("ul",[a("li",[t._v("浏览器引擎, 提供用户行为和渲染引擎之间的桥梁")])])]),t._v(" "),a("li",[t._v("Render Engine\n"),a("ul",[a("li",[t._v("用来可视化显示用户请求信息")])])]),t._v(" "),a("li",[t._v("Networking\n"),a("ul",[a("li",[t._v("提供网络接口,与平台无关,提供底层的接口")])])]),t._v(" "),a("li",[t._v("JS Interpreter\n"),a("ul",[a("li",[t._v("JS代码解释器, 反映到Render Engine显示")])])]),t._v(" "),a("li",[t._v("UI Backend\n"),a("ul",[a("li",[t._v("用于绘制一些基本的nativeUI,比如弹框和窗口, 与平台无关")])])]),t._v(" "),a("li",[t._v("Data Storage\n"),a("ul",[a("li",[t._v("管理用户数据和浏览器数据, 包括一些书签, 设置项")])])])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/browser_struct.png"),alt:"browser_struct"}})]),t._v(" "),a("h2",{attrs:{id:"render-engine-浏览器内核"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#render-engine-浏览器内核"}},[t._v("#")]),t._v(" Render Engine(浏览器内核)")]),t._v(" "),a("ul",[a("li",[t._v("Trident: IE浏览器")]),t._v(" "),a("li",[t._v("Gecko: Firefox浏览器")]),t._v(" "),a("li",[t._v("WebKit: Safari浏览器")]),t._v(" "),a("li",[t._v("Blink: Chrome/Opera/Edge浏览器")])]),t._v(" "),a("h2",{attrs:{id:"js-interpreter-js引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-interpreter-js引擎"}},[t._v("#")]),t._v(" JS Interpreter(Js引擎)")]),t._v(" "),a("blockquote",[a("p",[t._v("早期的Js引擎是内置在浏览器内核中, 随着现代前端技术的发展,大部分的浏览器的架构都将其拆分成单独进程来保证其执行效率")])]),t._v(" "),a("h3",{attrs:{id:"js引擎组成部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js引擎组成部分"}},[t._v("#")]),t._v(" JS引擎组成部分")]),t._v(" "),a("blockquote",[a("p",[t._v("严格意义上讲JS语言是解释型语言, 但目前大部分的JS引擎会将一部分的代码编译成字节码来提升执行效率")])]),t._v(" "),a("ol",[a("li",[t._v("编译器: 将源代码转换成AST语法树,在一些引擎会将其转成字节码")]),t._v(" "),a("li",[t._v("解释器: 接收字节码或者AST语法树,执行")]),t._v(" "),a("li",[t._v("JIT工具: 将字节码或AST语法树转成目标语言,直接执行,不需要解释器执行,这个也是现代JS引擎效率大大提升的原因")]),t._v(" "),a("li",[t._v("垃圾回收工具和分析工具: 负责垃圾回收和引擎的相关数据收集")])]),t._v(" "),a("h3",{attrs:{id:"常用浏览器使用的js引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用浏览器使用的js引擎"}},[t._v("#")]),t._v(" 常用浏览器使用的JS引擎")]),t._v(" "),a("ul",[a("li",[t._v("V8: 用于Chrome和Node")]),t._v(" "),a("li",[t._v("JavaScriptCore: 用于Safari等Webkit内核浏览器")]),t._v(" "),a("li",[t._v("SpiderMonkey: 用于Firefox")]),t._v(" "),a("li",[t._v("Chakra(JScript): 用于IE/Edge")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("渲染引擎和JS引擎")]),t._v(" "),a("ol",[a("li",[t._v("JS引擎提供接口供渲染引擎调用JS代码并获取结果")]),t._v(" "),a("li",[t._v("渲染引擎根据JS提供的桥接接口实现具体的功能,供JS引擎调用")]),t._v(" "),a("li",[t._v("两者之间的频繁调用会导致资源浪费")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/browers-JS-Render.png"),alt:"browers-JS-Render"}})]),t._v(" "),a("h2",{attrs:{id:"进程和线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程和线程"}},[t._v("#")]),t._v(" 进程和线程")]),t._v(" "),a("ul",[a("li",[t._v("把浏览器比作工厂, 进程就是车间, 线程就是流水线")]),t._v(" "),a("li",[t._v("进程之间是相互独立的,通过IPC进行通信")]),t._v(" "),a("li",[t._v("同一个进程中的线程是共用一块内存空间的,各个线程是相互协作的")]),t._v(" "),a("li",[t._v("对于linux和unix内核,没有线程一说,只有进程和弱进程之分")]),t._v(" "),a("li",[t._v("浏览器在进程和线程的处理有两种模式\n"),a("ul",[a("li",[t._v("一个进程和多个线程协作")]),t._v(" "),a("li",[t._v("多个进程通过一些进程通信")])])])]),t._v(" "),a("h2",{attrs:{id:"chrome多进程架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chrome多进程架构"}},[t._v("#")]),t._v(" Chrome多进程架构")]),t._v(" "),a("h3",{attrs:{id:"进程划分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程划分"}},[t._v("#")]),t._v(" 进程划分")]),t._v(" "),a("ul",[a("li",[t._v("主进程(浏览器进程): 控制浏览器除了网页视图区域以外的应用控制,包括地址栏,书签,前景后退;同时还包括调用网络请求和文件读取服务")]),t._v(" "),a("li",[t._v("渲染进程: 控制tab标签内的站点渲染, 通常一个tab一个渲染进程")]),t._v(" "),a("li",[t._v("GPU进程: 调用GPU进行图形计算,接收不同进程传递的信息并绘制到相同页面")]),t._v(" "),a("li",[t._v("插件进程: 用于浏览器插件的管理")]),t._v(" "),a("li",[t._v("实用进程: 网络服务,storage服务和一些native服务")])]),t._v(" "),a("h4",{attrs:{id:"进程示意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程示意"}},[t._v("#")]),t._v(" 进程示意")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/browser-arch2.png"),alt:"browser-arch2"}}),t._v(" "),a("h4",{attrs:{id:"chrome任务管理器示意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chrome任务管理器示意"}},[t._v("#")]),t._v(" Chrome任务管理器示意")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/browser1.jpeg"),alt:"browser1"}}),t._v(" "),a("h3",{attrs:{id:"多进程的优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程的优势"}},[t._v("#")]),t._v(" 多进程的优势")]),t._v(" "),a("ol",[a("li",[t._v("进程之间隔离,保证线程崩溃不会相互影响(比如一个Tab渲染出错不会影响另外Tab页渲染)")]),t._v(" "),a("li",[t._v("更好控制线程安全和沙盒,为某些进程设置安全性沙盒")])]),t._v(" "),a("h3",{attrs:{id:"多进程的缺陷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程的缺陷"}},[t._v("#")]),t._v(" 多进程的缺陷")]),t._v(" "),a("ol",[a("li",[t._v("多进程间的通讯相比单进程的线程通讯要更费时")]),t._v(" "),a("li",[t._v("会占用更多的内存空间,因此需要对不同的内核机型做优化")])]),t._v(" "),a("h3",{attrs:{id:"多进程改进"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程改进"}},[t._v("#")]),t._v(" 多进程改进")]),t._v(" "),a("h4",{attrs:{id:"_1-进程服务化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-进程服务化"}},[t._v("#")]),t._v(" 1. 进程服务化")]),t._v(" "),a("blockquote",[a("p",[t._v("更细粒化的拆分浏览器功能, 以便能够更加细致的控制其拆分或者组合成同一个进程")])]),t._v(" "),a("p",[t._v("在高性能的环境上将服务尽可能的拆分成不同的线程,来保证其稳定性\n在低性能的环境上将服务尽可能的组合成单一线程,来保证减少内存的占用大小\n"),a("img",{attrs:{src:t.$withBase("/browser/servicfication.svg"),alt:"servicfication"}})]),t._v(" "),a("h4",{attrs:{id:"_2-iframe进程隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-iframe进程隔离"}},[t._v("#")]),t._v(" 2. iframe进程隔离")]),t._v(" "),a("blockquote",[a("p",[t._v("除了为不同的tab设置不同的渲染进程的同时, 给tab下的iframe也单独设置渲染进程")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/isolation.png"),alt:"isolation"}}),t._v(" "),a("h4",{attrs:{id:"_3-渲染进程共用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-渲染进程共用"}},[t._v("#")]),t._v(" 3. 渲染进程共用")]),t._v(" "),a("p",[t._v("当a页面打开b页面的时候, 如果两个站点为同一个站点的时候会共用一个渲染进程")]),t._v(" "),a("h3",{attrs:{id:"what-happens-in-地址导航"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-happens-in-地址导航"}},[t._v("#")]),t._v(' What happens in "地址导航"?')]),t._v(" "),a("ol",[a("li",[t._v("主进程的UI线程(进程)获取渲染进程的用户输入,解析并判断是搜索项还是其他统一资源定位符(URL), 通知当前tab的渲染进程渲染loading状态")]),t._v(" "),a("li",[t._v("如果是搜索项,调用Storage线程(进程)获取配置项中的默认搜索引擎,根据规则拼接地址,交给network线程(进程)")]),t._v(" "),a("li",[t._v("如果是其他URL,判断Schemes值(统一资源标识符),根据不同协议调用不同的线程(进程)执行操作, 下面举几个🌰\n"),a("ul",[a("li",[t._v("file:// 调用File线程(进程)读取本地文件, 交给UI线程(进程),判断安全性后交给渲染进程进行渲染")]),t._v(" "),a("li",[t._v("http:// 调用network线程(进程)")]),t._v(" "),a("li",[t._v("weixin:// 这种应用范围开头的会查看本地的URL Schemes列表,如果哪个应用注册过该Schemes,就会跳转到该应用(俗称deeplink)")]),t._v(" "),a("li",[t._v("还有其他的,邮箱,电话啥的")])])]),t._v(" "),a("li",[t._v("network线程获取URL\n"),a("ul",[a("li",[t._v("检查service work是否有注册, 如果有的话,就会告知UI线程,UI线程会将其传给渲染进程中的工作线程执行,同时执行数据预加载(获取缓存数据或者发起网络请求)")]),t._v(" "),a("li",[t._v("如果没有的话, network线程会"),a("RouterLink",{attrs:{to:"/docs/computer/network.html#dns"}},[t._v("查询DNS获取ip地址")]),t._v(",调用socket方法,建立"),a("RouterLink",{attrs:{to:"/docs/computer/network.html#tcp"}},[t._v("TCP连接")])],1)])]),t._v(" "),a("li",[t._v("如果返回的状态是3xx,network线程会通知UI线程进行页面重定向到其他地址或者获取本地缓存")]),t._v(" "),a("li",[t._v("对返回的响应体,network线程会检查Content-Type类型,如果head头有缺失,会通过校验返回内容来确定类型")]),t._v(" "),a("li",[t._v("对于可渲染的内容(比如Html), network线程会进行安全检查("),a("a",{attrs:{href:"https://wsygoogol.github.io/2018/07/31/Google-Safe-Browsing-Api%E4%BB%8B%E7%BB%8D/",target:"_blank",rel:"noopener noreferrer"}},[t._v("safeBrowsing"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://juejin.cn/post/6844903831373889550",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORB"),a("OutboundLink")],1),t._v("),然后通知UI线程, 如果是下载的内容,会调用下载管理器下载到本地")]),t._v(" "),a("li",[t._v("UI线程获取渲染数据找到对应的渲染进程,不过可能在发送请求的时候已经准备好了渲染进程(但是如果发生重定向, 此时的渲染进程就会被抛弃, 一个新的渲染进程就会启动)")]),t._v(" "),a("li",[t._v("如果数据和渲染进程都准备好了,主进程就会向渲染进程提交本次导航,并持续传递数据流,当渲染进程已经确认好了,会通知主进程")]),t._v(" "),a("li",[t._v("主进程更新了地址栏的状态(安全标示和站点标示), 存储历史记录, 修改前进后退按钮状态")]),t._v(" "),a("li",[t._v("渲染进程开始文档加载(和10是同步的)")]),t._v(" "),a("li",[t._v("渲染进程完成文档加载后,会通知主进程,主进程会调用UI线程更新loading状态")]),t._v(" "),a("li",[t._v("重新导航\n"),a("ul",[a("li",[t._v("如果当地址栏地址改变重新请求时,回到第一步重新执行,但在这之前, 主进程会通知渲染进程检查当前进程有无beforeunload事件(有的话就执行)")]),t._v(" "),a("li",[t._v("点击事件造成重新请求时, 渲染进程会检查当前有无beforeunload事件,然后回到第一步执行")]),t._v(" "),a("li",[t._v("如果电脑配置允许, 重新请求的渲染进程和执行卸载当前渲染进程会一并执行")])])])]),t._v(" "),a("h3",{attrs:{id:"what-happens-in-渲染进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-happens-in-渲染进程"}},[t._v("#")]),t._v(' what happens in "渲染进程"')]),t._v(" "),a("blockquote",[a("p",[t._v("渲染进程的作用是将Html,js和css转换成用户可视化界面")])]),t._v(" "),a("h4",{attrs:{id:"渲染进程中的线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染进程中的线程"}},[t._v("#")]),t._v(" 渲染进程中的线程")]),t._v(" "),a("ol",[a("li",[t._v("主线程(GUI渲染线程,JS引擎线程, 定时器线程, 网络请求线程, 事件处理线程)")]),t._v(" "),a("li",[t._v("工作线程(多个)")]),t._v(" "),a("li",[t._v("合成线程\n"),a("ol",[a("li",[t._v("渲染进程中最先被告知垂直同步事件(操作系统告知浏览器刷新一帧的信号)")]),t._v(" "),a("li",[t._v("接收用户事件,会调节是否需要进入主线程")])])]),t._v(" "),a("li",[t._v("光栅线程\n"),a("ol",[a("li",[t._v("由合成线程派生出的线程,用于处理栅格化内容")])])])]),t._v(" "),a("h4",{attrs:{id:"渲染流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染流程"}},[t._v("#")]),t._v(" 渲染流程")]),t._v(" "),a("ol",[a("li",[t._v("渲染进程将 HTML 内容转换为能够读懂的 DOM 树结构。")]),t._v(" "),a("li",[t._v("渲染引擎将 CSS 样式表转化为浏览器可以理解的 styleSheets,计算出 DOM 节点的样式。\n"),a("ol",[a("li",[t._v("生成styleSheets")]),t._v(" "),a("li",[t._v("样式属性转换")]),t._v(" "),a("li",[t._v("计算每个节点的样式(样式继承&层叠规则)")])])]),t._v(" "),a("li",[t._v("创建布局树，并计算元素的布局信息。\n"),a("ol",[a("li",[t._v("剔除非显示节点")]),t._v(" "),a("li",[t._v("计算节点的位置信息")])])]),t._v(" "),a("li",[t._v("对布局树进行分层，并生成分层树。")]),t._v(" "),a("li",[t._v("为每个图层生成绘制列表，并将其提交到合成线程。")]),t._v(" "),a("li",[t._v("合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。")]),t._v(" "),a("li",[t._v("合成线程发送绘制图块命令 DrawQuad 给浏览器进程。")]),t._v(" "),a("li",[t._v("浏览器进程根据 DrawQuad 消息生成页面，并显示到显示器上。")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/render_process.png"),alt:"render_process"}}),t._v(" "),a("h4",{attrs:{id:"渲染进程在一帧中的执行过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染进程在一帧中的执行过程"}},[t._v("#")]),t._v(" 渲染进程在一帧中的执行过程")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/what_happend_render_process.png"),alt:"what_happend_render_process"}}),t._v(" "),a("p",[a("strong",[t._v("针对主线程的详细过程")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/what_happend_render_process_detail.png"),alt:"what_happend_render_process_detail"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("JS EventLoop")]),t._v(" "),a("p",[t._v("在上一帧结束后,触发JS的EventLoop机制,调用宏任务(包括用户的行为触发的回调事件,除了resize和scroll事件)和微任务")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Frame Start")]),t._v(" "),a("p",[t._v("开始刷新一帧")]),t._v(" "),a("ol",[a("li",[t._v("显卡有一个缓冲区的地方,存放着显示器要显示的图像,显示器按照一定频率读取这块缓冲区")]),t._v(" "),a("li",[t._v("显示器在读取下一帧时,会发出一个垂直同步信号(VSync)给操作系统,操作系统再通知浏览器刷新一帧, 合成线程是最早收到VSync事件的")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Event Handle")]),t._v(" "),a("ol",[a("li",[t._v("合成线程收到用户的行为事件(resize, scroll, toucheMove, mousemove), "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/animationend_event",target:"_blank",rel:"noopener noreferrer"}},[t._v("动画事件"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/onchange",target:"_blank",rel:"noopener noreferrer"}},[t._v("媒体查询事件"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("线程会判断是否需要进入主线程执行上面事件注册的回调,注意的是并非每一帧合成线程都会去处理这些事件的")]),t._v(" "),a("li",[t._v("所以resize和scroll事件是自带节流的")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("rAF")]),t._v(" "),a("ol",[a("li",[t._v("执行帧动画回调,"),a("strong",[t._v("红线表示在JS中当我们了scrollWidth、clientHeight、ComputedStyle等会触发了强制重排")])]),t._v(" "),a("li",[t._v("执行intersectionObserver回调")])])]),t._v(" "),a("p",[a("strong",[t._v("下面的渲染阶段浏览器会判断是否执行渲染")])]),t._v(" "),a("ol",[a("li",[t._v("浏览器判断更新渲染不会带来视觉上的改变.")]),t._v(" "),a("li",[t._v("帧动画回调为空.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Parse HTML HTML解析")]),t._v(" "),a("p",[t._v("解析HTML, 如果插入/删除DOM元素,会触发该过程")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Recalc Styles 样式更新")]),t._v(" "),a("p",[t._v("重新计算样式, 当修改样式或者类名改变的时候会触发该过程")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Layout 布局更新")]),t._v(" "),a("p",[t._v("计算每个课件可见元素的几何信息, 浏览器会判断哪些改变需要重新计算")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Update Layer Tree 更新图层树")]),t._v(" "),a("p",[t._v("创建层叠上下文, 为元素的深度进行排序")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Paint 绘制栅格化")]),t._v(" "),a("ol",[a("li",[t._v("记录要执行哪些绘画调用,对于新增的元素或者修改的元素,记录draw调用,序列化进一个叫做SkPicture的数据结构中")]),t._v(" "),a("li",[t._v("执行这些绘画调用, 进行栅格化,执行了draw调用,填充纹理, 会将SkPicture中的操作replay出来,这里才是将这些操作真正执行:光栅化和填充进位图")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Composite 合成")]),t._v(" "),a("ol",[a("li",[t._v("主线程里的这一步会计算出每个Graphics Layers的合成时所需要的data,包括位移（Translation）、缩放（Scale）、旋转（Rotation）、Alpha 混合等操作的参数")]),t._v(" "),a("li",[t._v("在信息计算完成后,会通知合成线程进行处理, 这将包括 will-change、重叠元素和硬件加速的 canvas 等.")]),t._v(" "),a("li",[t._v("合成线程会将图层分成计算好的图块")]),t._v(" "),a("li",[t._v("这一步其实没有真正完成最后的合成,直接通知执行主线程执行requestIdleCallback")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Raster Schedule and Rasterize 光栅调度和栅格化")]),t._v(" "),a("ol",[a("li",[t._v("一种是在CPU中执行, 合成线程派生出光栅线程,多线程并行执行SkPicture records中的绘画操作,最后commit上传到GPU绘制")]),t._v(" "),a("li",[t._v("另一种是直接在GPU中执行SkPicture records中的绘画操作,就是我们常说的GPU渲染")])])]),t._v(" "),a("h4",{attrs:{id:"构造dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构造dom"}},[t._v("#")]),t._v(" 构造DOM")]),t._v(" "),a("ol",[a("li",[t._v("主线程解析HTML文本数据,将其构建成DOM树(DOM是当前页面的结构表示,也是js可操作的数据和API)和CSSOM树")]),t._v(" "),a("li",[t._v("遇到js会阻塞HTML解析(添加async和defer不会阻塞)")]),t._v(" "),a("li",[t._v("通过DOM树和CSSOM树合成layout树")]),t._v(" "),a("li",[t._v("主进程遍历layout树生成绘制记录")]),t._v(" "),a("li",[t._v("栅格化layout树\n"),a("ul",[a("li",[t._v("老版本只栅格化当前视图区域的内容(光栅线程)并保存下来")]),t._v(" "),a("li",[t._v("新版本引入了合成概念(合成器线程+光栅线程)\n"),a("ul",[a("li",[t._v("遍历layout树生成图层树")]),t._v(" "),a("li",[t._v("合成器线程根据图层树将页面分成多个图层,每个图层划分成图块,调用光栅线程分别进行栅格化并存储在GPU内存中\n"),a("ul",[a("li",[t._v("合成器线程会调用GPU进程处理一些合成工作")]),t._v(" "),a("li",[t._v("合成器线程会优先栅格化可视视图中或者可视视图周围的图块")]),t._v(" "),a("li",[t._v("合成器会生成不同清晰度的图块,来响应用户对页面的放大缩小操作")]),t._v(" "),a("li",[a("strong",[t._v("此时合成线程没有涉及到主线程的计算,因此不会被样式计算和JS操作阻塞")])])])]),t._v(" "),a("li",[t._v("发生滚动或者动画时,通过移动图层的方式来合成一个新的帧")])])])])]),t._v(" "),a("li",[t._v("栅格化后,合成线程会收集DrawQuads(保存块内存地址和绘制位置信息)来构建成合成帧, 并发送给主进程的UI线程")]),t._v(" "),a("li",[t._v("UI线程把这些合成帧发送给GPU进程更新页面")])]),t._v(" "),a("h4",{attrs:{id:"non-fast-scrollable区域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#non-fast-scrollable区域"}},[t._v("#")]),t._v(" non-fast scrollable区域")]),t._v(" "),a("blockquote",[a("p",[t._v("合成线程会将页面中注册了事件监听的区域标记为non-fast scrollable区域, 如果用户事件发生在这些区域的时候, 合成线程会将该事件发给主线程处理,这时候,主线程就可能会阻塞合成线程")])]),t._v(" "),a("ol",[a("li",[t._v("为了最大程度地减少对主线程的过多调用，Chrome会合并连续事件（例如wheel，mousewheel，mousemove，pointermove，touchmove），并将调度延迟到下一个requestAnimationFrame之前。而针对keydown，keyup，mouseup，mousedown，touchstart和touchend等相对不怎么频繁发生的事件都会被立即派送给主线程。\n"),a("ul",[a("li",[t._v("对于合并的事件我们该如何获取具体的信息")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pointermove"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" events "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCoalescedEvents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pageX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pageX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("我们通常会用下面的方法,通过冒泡来监听某个元素,结果导致整个页面都被标记为none-fast scrollable区域")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchmove'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("preventDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("通过添加passive: true来告知合成线程不需要等待主线程的回应")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchmove'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("preventDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("passive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"回流和重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回流和重绘"}},[t._v("#")]),t._v(" 回流和重绘")]),t._v(" "),a("blockquote",[a("p",[t._v("回流一定会触发重绘,重绘不一定触发回流,但是无论重绘或者回流,都会导致渲染进程重新栅格化layout树")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://csstriggers.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看css属性引发的重绘和节流"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"js为什么会影响页面渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js为什么会影响页面渲染"}},[t._v("#")]),t._v(" JS为什么会影响页面渲染")]),t._v(" "),a("p",[t._v("Html解析器遇到js代码的时候,会暂停当前的解析,将脚本代码交给v8引擎处理,因为脚本很有可能会修改DOM结构")]),t._v(" "),a("h3",{attrs:{id:"css是如何影响页面渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css是如何影响页面渲染"}},[t._v("#")]),t._v(" CSS是如何影响页面渲染")]),t._v(" "),a("h3",{attrs:{id:"cssom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cssom"}},[t._v("#")]),t._v(" CSSOM")]),t._v(" "),a("ol",[a("li",[t._v("为js提供操作样式表的能力")]),t._v(" "),a("li",[t._v("为布局树的合成提供基础的样式信息")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("没有JS,页面解析流程")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("theme.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("geekbang com"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/browser/css_render_section_one.png"),alt:"css_render_section_one"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("有js")]),t._v(" "),a("p",[t._v("这块js会阻塞DOM的生成,并且同时js解析完成要依赖CSSOM,因此css也阻塞了DOM的生成")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("theme.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("geekbang com"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'time.geekbang.org'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("geekbang com"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("img",{attrs:{src:t.$withBase("/browser/css_render_section_two.png"),alt:"css_render_section_two"}})]),t._v(" "),a("h4",{attrs:{id:"缩短白屏时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缩短白屏时间"}},[t._v("#")]),t._v(" 缩短白屏时间")]),t._v(" "),a("ol",[a("li",[t._v("通过内联 JavaScript、内联 CSS 来移除这两种类型的文件下载，这样获取到 HTML 文件之后就可以直接开始渲染流程了。")]),t._v(" "),a("li",[t._v("但并不是所有的场合都适合内联，那么还可以尽量减少文件大小，比如通过 webpack 等工具移除一些不必要的注释，并压缩 JavaScript 文件。")]),t._v(" "),a("li",[t._v("还可以将一些不需要在解析 HTML 阶段使用的 JavaScript 标记上 async 或者 defer。")]),t._v(" "),a("li",[t._v("对于大的 CSS 文件，可以通过媒体查询属性，将其拆分为多个不同用途的 CSS 文件，这样只有在特定的场景下才会加载特定的 CSS 文件。")])]),t._v(" "),a("h3",{attrs:{id:"分层和合成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分层和合成"}},[t._v("#")]),t._v(" 分层和合成")]),t._v(" "),a("p",[t._v("为了提升每帧的渲染效率,将元素分解为多个图层的操作就称为分层，最后将这些图层合并到一起的操作就称为合成")]),t._v(" "),a("h4",{attrs:{id:"如何实现分层和合成机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何实现分层和合成机制"}},[t._v("#")]),t._v(" 如何实现分层和合成机制")]),t._v(" "),a("p",[t._v("分层: 在布局树生成后,会生成层树,最终在渲染引擎的主线程生成对应的绘制指令\n合成: 在生成绘制指令后,进行栅格化, 形成一张张图片,最后由合成线程进行合成")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/browser/layered_composite.png"),alt:"layered_composite"}}),t._v(" "),a("h3",{attrs:{id:"chrome-浏览器为标签页分配渲染进程的策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chrome-浏览器为标签页分配渲染进程的策略"}},[t._v("#")]),t._v(" Chrome 浏览器为标签页分配渲染进程的策略")]),t._v(" "),a("ol",[a("li",[t._v("如果两个标签页都位于同一个浏览上下文组，且属于同一站点，那么这两个标签页会被浏览器分配到同一个渲染进程中")]),t._v(" "),a("li",[t._v("如果这两个条件不能同时满足，那么这两个标签页会分别使用不同的渲染进程来渲染")])]),t._v(" "),a("h4",{attrs:{id:"阻止跳转链接站点成为同一个浏览上下文组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻止跳转链接站点成为同一个浏览上下文组"}},[t._v("#")]),t._v(" 阻止跳转链接站点成为同一个浏览上下文组")]),t._v(" "),a("p",[t._v('a标签添加ref="noopener noreferer"属性来断开上下文组关系')]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://fh.dasouch.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("_blank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("noopener noreferer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"站点隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#站点隔离"}},[t._v("#")]),t._v(" 站点隔离")]),t._v(" "),a("p",[t._v("页面中内嵌的iframe同样遵守同一站点分配原则\n"),a("img",{attrs:{src:t.$withBase("/browser/siteIsolation.png"),alt:"siteIsolation"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);